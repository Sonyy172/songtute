!function(e){acf.fields.repeater=acf.field.extend({type:"repeater",$el:null,$input:null,$table:null,$tbody:null,$clone:null,actions:{ready:"initialize",append:"initialize",show:"show"},events:{'click a[data-event="add-row"]':"_add",'click a[data-event="remove-row"]':"_remove",'click a[data-event="collapse-row"]':"_collapse","mouseenter td.order":"_mouseenter"},focus:function(){this.$el=this.$field.find(".acf-repeater:first"),this.$input=this.$el.children("input"),this.$table=this.$el.children("table"),this.$tbody=this.$table.children("tbody"),this.$clone=this.$tbody.children("tr.acf-clone"),this.o=acf.get_data(this.$el,{min:0,max:0}),this.o.min=parseInt(this.o.min),this.o.max=parseInt(this.o.max)},initialize:function(){acf.disable_form(this.$clone,"repeater"),this.render()},show:function(){this.$tbody.find(".acf-field:visible").each(function(){acf.do_action("show_field",e(this))})},count:function(){return this.$tbody.children().length-1},render:function(){var t=this.$el.find("> .acf-actions .button");this.$tbody.children().each(function(t){e(this).find("> td.order > span").html(t+1)}),0==this.count()?this.$el.addClass("-empty"):this.$el.removeClass("-empty"),this.o.max>0&&this.count()>=this.o.max?t.addClass("disabled"):t.removeClass("disabled")},add:function(e){if(e=e||this.$clone,this.o.max>0&&this.count()>=this.o.max)return alert(acf._e("repeater","max").replace("{max}",this.o.max)),!1;var t=this.$field;return $el=acf.duplicate(this.$clone),$el.removeClass("acf-clone"),acf.enable_form($el,"repeater"),e.before($el),this.doFocus(t),this.render(),acf.validation.remove_error(this.$field),this.sync(),$el},remove:function(e){var t=this;if(this.count()<=this.o.min)return alert(acf._e("repeater","min").replace("{min}",this.o.min)),!1;acf.do_action("remove",e),acf.remove_tr(e,function(){t.$input.trigger("change"),t.render(),t.sync(),acf.do_action("refresh",t.$field)})},sync:function(){var t="collapsed_"+this.$field.data("key"),a=[];this.$tbody.children().each(function(t){e(this).hasClass("-collapsed")&&a.push(t)}),acf.update_user_setting(t,a.join(","))},_mouseenter:function(e){if(!this.$tbody.hasClass("ui-sortable")&&1!=this.o.max){var t=this;this.$tbody.sortable({items:"> tr",handle:"> td.order",forceHelperSize:!0,forcePlaceholderSize:!0,scroll:!0,stop:function(e,a){t.render()},update:function(e,a){t.$input.trigger("change")}})}},_add:function(e){$row=!1,e.$el.hasClass("acf-icon")&&($row=e.$el.closest(".acf-row")),this.add($row)},_remove:function(e){var t=this,a=e.$el.closest(".acf-row");a.addClass("-hover"),acf.tooltip.confirm_remove(e.$el,function(e){a.removeClass("-hover"),e&&t.remove(a)})},_collapse:function(e){var t=e.$el.closest(".acf-row"),a=this.$field;t.hasClass("-collapsed")?(t.removeClass("-collapsed"),acf.do_action("show",t,"collapse")):(t.addClass("-collapsed"),acf.do_action("hide",t,"collapse")),this.set("$field",a).sync(),acf.do_action("refresh",this.$field)}})}(jQuery),function(e){acf.fields.flexible_content=acf.field.extend({type:"flexible_content",$el:null,$input:null,$values:null,$clones:null,actions:{ready:"initialize",append:"initialize",show:"show"},events:{'click [data-name="add-layout"]':"_open",'click [data-name="remove-layout"]':"_remove",'click [data-name="collapse-layout"]':"_collapse","mouseenter .acf-fc-layout-handle":"_mouseenter"},focus:function(){this.$el=this.$field.find(".acf-flexible-content:first"),this.$input=this.$el.children("input"),this.$values=this.$el.children(".values"),this.$clones=this.$el.children(".clones"),this.o=acf.get_data(this.$el),this.o.min=this.o.min||0,this.o.max=this.o.max||0},count:function(){return this.$values.children(".layout").length},initialize:function(){acf.disable_form(this.$clones,"flexible_content"),this.render()},show:function(){this.$values.find(".acf-field:visible").each(function(){acf.do_action("show_field",e(this))})},render:function(){var t=this.$el.find("> .acf-actions .button");this.$values.children(".layout").each(function(t){e(this).find("> .acf-fc-layout-handle .acf-fc-layout-order").html(t+1)}),0==this.count()?this.$el.addClass("empty"):this.$el.removeClass("empty"),this.o.max>0&&this.count()>=this.o.max?t.addClass("disabled"):t.removeClass("disabled")},render_layout_title:function(t){var a=t.children("input"),i=a.attr("name").replace("[acf_fc_layout]",""),l={action:"acf/fields/flexible_content/layout_title",field_key:this.$field.data("key"),i:t.index(),layout:a.val(),value:acf.serialize(t,i)};e.ajax({url:acf.get("ajaxurl"),data:acf.prepare_for_ajax(l),dataType:"html",type:"post",success:function(e){e&&t.find("> .acf-fc-layout-handle").html(e)}})},validate_add:function(t){t=t||"";var a=this.o.max,i=this.count();if(a&&i>=a){var l=1==a?"layout":"layouts";return r=(r=(r=acf._e("flexible_content","max")).replace("{max}",a)).replace("{identifier}",acf._e("flexible_content",l)),alert(r),!1}if(t){var n=e(this.$el.children(".tmpl-popup").html()).find('[data-layout="'+t+'"]'),s=parseInt(n.attr("data-max")),c=this.$values.children('.layout[data-layout="'+t+'"]').length;if(s>0&&c>=s){var r;l=1==s?"layout":"layouts";return r=(r=(r=(r=acf._e("flexible_content","max_layout")).replace("{max}",c)).replace("{label}",'"'+n.text()+'"')).replace("{identifier}",acf._e("flexible_content",l)),alert(r),!1}}return!0},validate_remove:function(t){t=t||"";var a=this.o.min,i=this.count();if(a>0&&i<=a){var l=1==a?"layout":"layouts";return r=(r=(r=(r=acf._e("flexible_content","min")+", "+acf._e("flexible_content","remove")).replace("{min}",a)).replace("{identifier}",acf._e("flexible_content",l))).replace("{layout}",acf._e("flexible_content","layout")),confirm(r)}if(t){var n=e(this.$el.children(".tmpl-popup").html()).find('[data-layout="'+t+'"]'),s=parseInt(n.attr("data-min")),c=this.$values.children('.layout[data-layout="'+t+'"]').length;if(s>0&&c<=s){var r;l=1==s?"layout":"layouts";return r=(r=(r=(r=(r=acf._e("flexible_content","min_layout")+", "+acf._e("flexible_content","remove")).replace("{min}",c)).replace("{label}",'"'+n.text()+'"')).replace("{identifier}",acf._e("flexible_content",l))).replace("{layout}",acf._e("flexible_content","layout")),confirm(r)}}return!0},sync:function(){var t="collapsed_"+this.$field.data("key"),a=[];this.$values.children(".layout").each(function(t){e(this).hasClass("-collapsed")&&a.push(t)}),acf.update_user_setting(t,a.join(","))},add:function(e,t){if(t=t||!1,!this.validate_add(e))return!1;var a=this.$field,i=this.$clones.children('.layout[data-layout="'+e+'"]');$el=acf.duplicate(i),acf.enable_form($el,"flexible_content"),this.$el.children(".no-value-message").hide(),t?t.before($el):this.$values.append($el),this.doFocus(a),this.render(),acf.validation.remove_error(this.$field),this.sync()},_mouseenter:function(e){if(!this.$values.hasClass("ui-sortable")&&1!=this.o.max){var t=this;this.$values.sortable({items:"> .layout",handle:"> .acf-fc-layout-handle",forceHelperSize:!0,forcePlaceholderSize:!0,scroll:!0,stop:function(e,a){t.render()},update:function(e,a){t.$input.trigger("change")}})}},_open:function(t){if(!this.validate_add())return!1;var a=this,i=e(this.$el.children(".tmpl-popup").html()),l={};this.$values.children(".layout").each(function(){var t=e(this).data("layout");l[t]=l[t]?l[t]+1:1}),i.find("a").each(function(){var t=e(this),a=t.data("min")||0,i=t.data("max")||0,n=t.data("layout"),s=l[n]||0;if(i&&s>=i)t.addClass("disabled");else if(a){var c=a-s,r=acf._e("flexible_content","required"),o=1==c?"layout":"layouts";if(r=(r=(r=(r=r.replace("{required}",c)).replace("{min}",a)).replace("{label} ","")).replace("{identifier}",acf._e("flexible_content",o)),c>0){var d=e('<span class="badge"></span>').attr("title",r).text(c);t.append(d)}}});var n=null;t.$el.hasClass("acf-icon")&&(n=t.$el.closest(".layout")).addClass("-open"),e("body").append(i),this.position_popup(i,t.$el);var s=function(t,l){t.preventDefault(),t.stopImmediatePropagation(),i.off("click","a",c),e("body").off("click",r),i.remove(),null!==n&&n.removeClass("-open"),null!==l&&a.add(l,n)},c=function(t){s(t,e(this).attr("data-layout"))},r=function(e){s(e,null)};i.on("click","a",c),e("body").on("click",r)},position_popup:function(t,a){target_w=a.outerWidth(),target_h=a.outerHeight(),target_t=a.offset().top,target_l=a.offset().left,popup_w=t.outerWidth(),popup_h=t.outerHeight();var i=target_t-popup_h,l=target_l+target_w/2-popup_w/2;i-e(window).scrollTop()<10?(t.addClass("-bottom"),i=target_t+target_h):t.addClass("-top"),l<10?(t.addClass("-right"),l=target_l):l+popup_w+10>e(window).width()&&(t.addClass("-left"),l=target_l+target_w-popup_w),t.css({top:i,left:l})},_remove:function(e){console.log("flex _remove");var t=this,a=e.$el.closest(".layout");a.addClass("-open"),acf.tooltip.confirm_remove(e.$el,function(e){e?t.remove_layout(a):a.removeClass("-open")})},remove_layout:function(e){var t=this;if(this.validate_remove(e.attr("data-layout"))){var a=null,i=0;1==this.count()&&(i=(a=this.$el.children(".no-value-message")).outerHeight()),acf.remove_el(e,function(){null!==a&&a.show(),t.render(),t.$input.trigger("change"),t.sync()},i)}},_collapse:function(e){var t=e.$el.closest(".layout"),a=t.hasClass("-collapsed")?"show":"hide";this.render_layout_title(t),t.toggleClass("-collapsed"),this.sync(),acf.do_action(a,t,"collapse")}})}(jQuery),function(e){acf.fields.gallery=acf.field.extend({type:"gallery",$el:null,$main:null,$side:null,$attachments:null,$input:null,actions:{ready:"initialize",append:"initialize",show:"resize"},events:{"click .acf-gallery-attachment":"_select","click .acf-gallery-add":"_add","click .acf-gallery-remove":"_remove","click .acf-gallery-close":"_close","change .acf-gallery-sort":"_sort","click .acf-gallery-edit":"_edit","click .acf-gallery-update":"_update","change .acf-gallery-side input":"_update","change .acf-gallery-side textarea":"_update","change .acf-gallery-side select":"_update"},focus:function(){this.$el=this.$field.find(".acf-gallery:first"),this.$main=this.$el.children(".acf-gallery-main"),this.$side=this.$el.children(".acf-gallery-side"),this.$attachments=this.$main.children(".acf-gallery-attachments"),this.$input=this.$el.find("input:first"),this.o=acf.get_data(this.$el),this.o.min=this.o.min||0,this.o.max=this.o.max||0},initialize:function(){var t=this,a=this.$field;this.$attachments.unbind("sortable").sortable({items:".acf-gallery-attachment",forceHelperSize:!0,forcePlaceholderSize:!0,scroll:!0,start:function(e,t){t.placeholder.html(t.item.html()),t.placeholder.removeAttr("style")}}),this.$el.unbind("resizable").resizable({handles:"s",minHeight:200,stop:function(e,t){acf.update_user_setting("gallery_height",t.size.height)}}),e(window).on("resize",function(){t.set("$field",a).resize()}),this.render(),this.resize()},resize:function(){for(var e=4,t=this.$el.width(),a=4;a<20;a++){var i=t/a;if(100<i&&i<175){e=a;break}}e=Math.min(e,8),this.$el.attr("data-columns",e)},render:function(){var e=this.$main.find(".acf-gallery-sort"),t=this.$main.find(".acf-gallery-add");this.o.max>0&&this.count()>=this.o.max?t.addClass("disabled"):t.removeClass("disabled"),this.count()?e.removeClass("disabled"):e.addClass("disabled")},open_sidebar:function(){this.$el.addClass("sidebar-open"),this.$main.find(".acf-gallery-sort").hide();var e=this.$el.width()/3;e=parseInt(e),e=Math.max(e,350),this.$side.children(".acf-gallery-side-inner").css({width:e-1}),this.$side.animate({width:e-1},250),this.$main.animate({right:e},250)},_close:function(e){this.close_sidebar()},close_sidebar:function(){this.$el.removeClass("sidebar-open");var t=this.$el.find(".acf-gallery-sort");this.get_attachment("active").removeClass("active"),this.$side.find("input, textarea, select").attr("disabled","disabled"),this.$main.animate({right:0},250),this.$side.animate({width:0},250,function(){t.show(),e(this).find(".acf-gallery-side-data").html("")})},count:function(){return this.get_attachments().length},get_attachments:function(){return this.$attachments.children(".acf-gallery-attachment")},get_value:function(){var t=[];return this.get_attachments().each(function(){t.push(e(this).data("id"))}),t},get_attachment:function(e){return e="active"===(e=e||0)?".active":'[data-id="'+e+'"]',this.$attachments.children(".acf-gallery-attachment"+e)},render_attachment:function(e){e=this.prepare(e);var t=this.get_attachment(e.id),a=(t.find(".margin"),t.find("img")),i=t.find(".filename"),l=t.find('input[type="hidden"]'),n=e.url;"image"==e.type?i.remove():"video"==e.type?(n=(n=(n=e.url).replace(".mp4",".mp4/thumb-1.jpg")).replace("//img.","//thumb."),i.text("video"),i.attr("style","width:35px; padding: 2%; left:auto; background-color: #23282D; color: #fff;")):(n=acf.maybe_get(e,"thumb.src"),i.text(e.filename)),n||(n=acf._e("media","default_icon"),t.addClass("-icon")),a.attr({src:n,alt:e.alt,title:e.title}),acf.val(l,e.id)},_add:function(e){if(this.o.max>0&&this.count()>=this.o.max)acf.validation.add_warning(this.$field,acf._e("gallery","max"));else{var t=this,a=this.$field;this.get_attachments().each(function(){});acf.media.popup({title:acf._e("gallery","select"),mode:"select",type:"",field:this.$field.data("key"),multiple:"add",library:this.o.library,mime_types:this.o.mime_types,selected:this.get_value(),select:function(e,i){t.set("$field",a).add_attachment(e,i)}})}},add_attachment:function(t,a){if(a=a||0,t=this.prepare(t),!(this.o.max>0&&this.count()>=this.o.max||this.get_attachment(t.id).exists())){var i=this.$el.find('input[type="hidden"]:first').attr("name"),l=['<div class="acf-gallery-attachment" data-id="'+t.id+'">','<input type="hidden" value="'+t.id+'" name="'+i+'[]">','<div class="margin" title="">','<div class="thumbnail">','<img src="" alt="">',"</div>",'<div class="filename"></div>',"</div>",'<div class="actions">','<a href="#" class="acf-icon -cancel dark acf-gallery-remove" data-id="'+t.id+'"></a>',"</div>","</div>"].join(""),n=e(l);if(this.$attachments.append(n),"prepend"===this.o.insert){var s=this.$attachments.children(":eq("+a+")");s.exists()&&s.before(n)}this.render_attachment(t),this.render(),this.$input.trigger("change")}},_select:function(e){var t=e.$el.data("id");this.select_attachment(t)},select_attachment:function(e){var t=this.get_attachment(e);t.hasClass("active")||(this.$side.find(":focus").trigger("blur"),this.get_attachment("active").removeClass("active"),t.addClass("active"),this.fetch(e),this.open_sidebar())},prepare:function(e){if((e=e||{})._valid)return e;var t={id:"",url:"",alt:"",title:"",filename:""};return e.id&&((t=e.attributes).url=acf.maybe_get(t,"sizes.medium.url",t.url)),t._valid=!0,t},fetch:function(t){var a={action:"acf/fields/gallery/get_attachment",field_key:this.$field.data("key"),id:t};if(this.$el.data("xhr")&&this.$el.data("xhr").abort(),"string"==typeof t&&0===t.indexOf("_")){var i=this.get_attachment(t).find('input[type="hidden"]').val();i=e.parseJSON(i),a.attachment=i}var l=e.ajax({url:acf.get("ajaxurl"),dataType:"html",type:"post",cache:!1,data:acf.prepare_for_ajax(a),context:this,success:this.fetch_success});this.$el.data("xhr",l)},fetch_success:function(e){if(e){var t=this.$side.find(".acf-gallery-side-data");t.html(e),t.find(".compat-field-acf-form-data").remove();var a=t.find("> .compat-attachment-fields > tbody > tr").detach();t.find("> table.form-table > tbody").append(a),t.find("> .compat-attachment-fields").remove(),acf.do_action("append",t)}},_sort:function(t){var a=t.$el.val();if(a){var i={action:"acf/fields/gallery/get_sort_order",field_key:this.$field.data("key"),ids:[],sort:a};this.get_attachments().each(function(){var t=e(this).attr("data-id");t&&i.ids.push(t)});e.ajax({url:acf.get("ajaxurl"),dataType:"json",type:"post",cache:!1,data:acf.prepare_for_ajax(i),context:this,success:this._sort_success})}},_sort_success:function(e){if(acf.is_ajax_success(e)){e.data.reverse();for(i in e.data){var t=e.data[i],a=this.get_attachment(t);this.$attachments.prepend(a)}}},_update:function(){var t=this.$side.find(".acf-gallery-update"),a=this.$side.find(".acf-gallery-edit"),i=this.$side.find(".acf-gallery-side-data"),l=(a.data("id"),acf.serialize(i));if(t.attr("disabled"))return!1;t.attr("disabled","disabled"),t.before('<i class="acf-loading"></i>'),l.action="acf/fields/gallery/update_attachment",e.ajax({url:acf.get("ajaxurl"),data:acf.prepare_for_ajax(l),type:"post",dataType:"json",complete:function(e){t.removeAttr("disabled"),t.prev(".acf-loading").remove()}})},_remove:function(e){e.stopPropagation();var t=e.$el.data("id");this.remove_attachment(t)},remove_attachment:function(e){this.close_sidebar(),this.get_attachment(e).remove(),this.render(),this.$input.trigger("change")},_edit:function(e){var t=e.$el.data("id");this.edit_attachment(t)},edit_attachment:function(e){var t=this,a=this.$field;acf.media.popup({mode:"edit",title:acf._e("image","edit"),button:acf._e("image","update"),attachment:e,select:function(i){t.set("$field",a).render_attachment(i),t.fetch(e)}})}});acf.model.extend({actions:{ready:"ready",validation_begin:"validation_begin",validation_failure:"validation_failure"},ready:function(){acf.isset(window,"wp","media","view")&&this.customize_Attachment()},validation_begin:function(){e(".acf-gallery-side-data").each(function(){acf.disable_form(e(this),"gallery")})},validation_failure:function(){e(".acf-gallery-side-data").each(function(){acf.enable_form(e(this),"gallery")})},customize_Attachment:function(){var e=wp.media.view.Attachment.Library;wp.media.view.Attachment.Library=e.extend({render:function(){var t=acf.media.frame(),a=acf.maybe_get(t,"acf.selected"),i=acf.maybe_get(this,"model.attributes.id");return a&&a.indexOf(i)>-1&&this.$el.addClass("acf-selected"),e.prototype.render.apply(this,arguments)}})}})}(jQuery);